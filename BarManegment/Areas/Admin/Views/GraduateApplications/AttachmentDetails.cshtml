@model BarManegment.Models.Attachment

@{
    ViewBag.Title = "تفاصيل المرفق";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    var fileExtension = System.IO.Path.GetExtension(Model.FilePath ?? "").ToLower();
    var imageExtensions = new[] { ".jpg", ".jpeg", ".png", ".gif", ".bmp" };
    bool isImage = imageExtensions.Contains(fileExtension);
    bool isPdf = fileExtension == ".pdf";
}

<div class="container-fluid pt-4 px-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4 class="mb-0">@ViewBag.Title: @Model.OriginalFileName</h4>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a href="@Url.Action("Index", "Home")">الرئيسية</a></li>
                        <li class="breadcrumb-item"><a href="@Url.Action("Index", "GraduateApplications")">طلبات الخريجين</a></li>
                        <li class="breadcrumb-item"><a href="@Url.Action("Edit", "GraduateApplications", new { id = Model.GraduateApplicationId })">تعديل طلب: @Model.GraduateApplication.ArabicName</a></li>
                        <li class="breadcrumb-item active" aria-current="page">تفاصيل المرفق</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- عامود عرض البيانات -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0"><i class="bi bi-info-circle-fill me-2"></i> بيانات المرفق</h5>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-5">نوع المرفق:</dt>
                        <dd class="col-sm-7">@Html.DisplayFor(model => model.AttachmentType.Name)</dd>

                        <dt class="col-sm-5">الاسم الأصلي:</dt>
                        <dd class="col-sm-7">@Html.DisplayFor(model => model.OriginalFileName)</dd>

                        <dt class="col-sm-5">تاريخ الرفع:</dt>
                        <dd class="col-sm-7">@Model.UploadDate.ToString("yyyy-MM-dd hh:mm tt")</dd>
                    </dl>
                    <hr />
                    <div class="d-grid gap-2">
                        <a href="@Url.Content(Model.FilePath)" class="btn btn-primary" download="@Model.OriginalFileName">
                            <i class="bi bi-download me-1"></i> تحميل الملف
                        </a>
                        <a href="@Url.Action("Edit", "GraduateApplications", new { id = Model.GraduateApplicationId })" class="btn btn-secondary">
                            <i class="bi bi-arrow-right-circle me-1"></i> العودة لصفحة التعديل
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- عامود عرض الملف -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0"><i class="bi bi-file-earmark-text-fill me-2"></i> معاينة الملف</h5>
                </div>
                <div class="card-body text-center" style="min-height: 400px;">
                    @if (isImage)
                    {
                        <!-- === بداية التعديل === -->
                        <img src="@Url.Action("GetAttachmentFile", new { id = Model.Id })" class="img-fluid rounded" alt="@Model.OriginalFileName" style="max-height: 70vh;" />
                        <!-- === نهاية التعديل === -->
                    }
                    else if (isPdf)
                    {
                        <!-- === بداية التعديل: استخدام iframe لعرض PDF === -->
                        <iframe src="@Url.Action("GetAttachmentFile", new { id = Model.Id })" style="width:100%; height:700px;" frameborder="0"></iframe>
                        <!-- === نهاية التعديل === -->
                    }
                    else
                    {
                        <div class="my-5">
                            <i class="bi bi-file-earmark-zip-fill" style="font-size: 5rem; color: #6c757d;"></i>
                            <h5 class="mt-3">لا يمكن عرض هذا النوع من الملفات مباشرة.</h5>
                            <p class="text-muted">الرجاء تحميل الملف لعرضه على جهازك.</p>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>