@model BarManegment.Areas.Admin.ViewModels.ContractPrintViewModel
@{
    Layout = null;
    ViewBag.Title = "وكالة خاصة (جواز سفر)";
}

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <title>@ViewBag.Title - @Model.TransactionId</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <style>
        /* إعدادات الصفحة */
        body {
            background-color: #525659;
            font-family: 'Amiri', serif;
            margin: 0;
            padding: 0;
            color: #000;
        }

        .paper {
            width: 210mm;
            height: 297mm;
            background: white;
            margin: 10px auto;
            padding: 10mm 15mm;
            position: relative;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }

        /* الشريط العلوي */
        .top-info-bar {
            display: flex;
            justify-content: space-between;
            border-bottom: 2px solid #000;
            padding-bottom: 5px;
            margin-bottom: 10px;
            font-family: 'Cairo', sans-serif;
            font-size: 12px;
            font-weight: bold;
        }

        /* العنوان - تم تعديله لإزالة text-underline-offset */
        .doc-title {
            text-align: center;
            margin-bottom: 15px;
        }

            .doc-title span {
                font-family: 'Cairo', sans-serif;
                font-size: 22px;
                font-weight: 700;
                border-bottom: 1px solid #000; /* بديل للتسطير */
                padding-bottom: 3px;
                display: inline-block;
            }

        /* المحتوى */
        .content {
            font-size: 15px;
            line-height: 1.5;
            text-align: justify;
            flex-grow: 1;
        }

            .content p {
                margin-bottom: 6px;
            }

        .bold {
            font-weight: bold;
        }

        /* الجدول */
        .minors-table {
            width: 100%;
            border-collapse: collapse;
            margin: 8px 0;
            font-size: 13px;
            font-family: 'Cairo', sans-serif;
        }

            .minors-table th, .minors-table td {
                border: 1px solid #000;
                padding: 3px 5px;
                text-align: center;
            }

            .minors-table th {
                background-color: #f0f0f0 !important;
                /* تم إبقاء webkit فقط لتجنب التحذير */
                -webkit-print-color-adjust: exact;
            }

        /* منطقة المرفقات والتوقيع */
        .middle-section {
            display: flex;
            justify-content: space-between;
            align-items: flex-end; /* بدلاً من end */
            margin: 10px 0;
            border-top: 1px dotted #ccc;
            padding-top: 10px;
        }

        .attachments-area {
            display: flex;
            /* تم إزالة gap واستبدالها بالهامش في العناصر */
        }

        .frame-box {
            border: 1px dashed #555;
            background: #fafafa;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 11px;
            font-family: 'Cairo', sans-serif;
            color: #777;
            margin-left: 10px; /* بديل لـ gap */
        }

            .frame-box:last-child {
                margin-left: 0;
            }

        .id-box {
            width: 100mm;
            height: 80mm;
        }

        .photo-box {
            width: 30mm;
            height: 40mm;
        }

        /* منطقة المصادقة */
        .certification-box {
            border: 2px solid #000;
            padding: 10px;
            margin-top: auto;
            background-color: #fff;
        }

        .cert-title {
            font-family: 'Cairo', sans-serif;
            font-weight: bold;
            font-size: 13px;
            margin-bottom: 5px;
            text-decoration: underline;
        }

        .cert-text {
            font-size: 13px;
            text-align: justify;
            margin-bottom: 10px;
        }

        .signatures-grid {
            display: table; /* استخدام table لتوزيع متساوي قديم الطراز لكن مضمون */
            width: 100%;
            margin-top: 10px;
        }

        .sig-item {
            display: table-cell;
            text-align: center;
            width: 25%;
            vertical-align: top;
        }

        .sig-label {
            font-family: 'Cairo', sans-serif;
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 25px;
        }

        .sig-line {
            border-bottom: 1px solid #000;
            width: 80%;
            margin: 0 auto;
        }

        .footer {
            text-align: center;
            font-size: 10px;
            font-family: 'Cairo', sans-serif;
            margin-top: 5px;
            color: #666;
        }

        /* الطباعة */
        @@media print {
            body {
                background: none;
            }

            .paper {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
                border: none;
                box-shadow: none;
            }

            .no-print {
                display: none;
            }

            .minors-table th {
                -webkit-print-color-adjust: exact;
            }
        }
    </style>
</head>
<body>

    <div class="no-print" style="position:fixed; top:10px; left:10px; z-index:100;">
        <button onclick="window.print()" class="btn btn-primary" style="padding:10px 20px; font-weight:bold; cursor:pointer; background:#000; color:#fff; border:none;">طباعة</button>
    </div>

    <div class="paper">
        <div class="top-info-bar">
            <div>رقم المعاملة: @Model.TransactionId</div>
            <div>التاريخ: @Model.TransactionDate.ToString("yyyy/MM/dd")</div>
        </div>

        <div class="doc-title">
            <span>وكالة خاصة (جواز سفر)</span>
        </div>

        <div class="content">
            @{
                var firstParty = Model.Parties.FirstOrDefault(p => p.PartyType == 1);
                var secondParty = Model.Parties.FirstOrDefault(p => p.PartyType == 2);
            }

            <p>
                أنا الموقع أدناه: <span class="bold">@(firstParty?.PartyName)</span>،
                هوية رقم: (<span class="bold">@(firstParty?.PartyIDNumber)</span>)،
                @if (!string.IsNullOrEmpty(Model.AgentLegalCapacity))
                {<span> وبصفتي: <span class="bold">@Model.AgentLegalCapacity</span></span> }
            else
            { <span> وبصفتي الشخصية</span>}
                @if (Model.Minors != null && Model.Minors.Any())
                {<span>، عن القاصرين المذكورين:</span>}
                .
            </p>

            @if (Model.Minors != null && Model.Minors.Any())
            {
                <table class="minors-table">
                    <thead>
                        <tr>
                            <th width="5%">م</th>
                            <th width="45%">الاسم</th>
                            <th width="30%">رقم الهوية</th>
                            <th width="20%">الصفة</th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (int i = 0; i < Model.Minors.Count; i++)
                        {
                            <tr>
                                <td>@(i + 1)</td>
                                <td class="bold">@Model.Minors[i].MinorName</td>
                                <td>@Model.Minors[i].MinorIDNumber</td>
                                <td>@(Model.Minors[i].MinorRelationship?.Name)</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }

            <p>
                وكلت عني السيد/ة: <span class="bold">@(secondParty?.PartyName)</span>،
                هوية رقم: (<span class="bold">@(secondParty?.PartyIDNumber)</span>)،
                ليقوم مقامي في مراجعة وزارة الداخلية ودوائر الجوازات لغايات:
                <br />
                <span class="bold" style="border-bottom: 1px solid #000; padding-bottom: 2px;">تقديم طلبات استصدار و/أو تجديد جوازات سفر واستلامها</span>
                @if (Model.IsActingForSelf)
                {<span>(لي وللقاصرين)</span> }
                else if (Model.Minors != null && Model.Minors.Any())
                { <span>(للقاصرين أعلاه)</span> }
                else
                { <span>(لي شخصياً)</span>}
                ، والتوقيع نيابة عني على كافة الأوراق اللازمة ودفع الرسوم.
            </p>

            <p>
                وكالة خاصة مفوضة لقوله وفعله، وله الحق في توكيل الغير، وإقراراً مني بذلك وقعت.
            </p>

            <div class="middle-section">
                <div class="attachments-area">
                    <div class="frame-box id-box">
                        <i class="bi bi-card-heading" style="font-size:1.2rem"></i>
                        صورة الهوية
                    </div>
                    <div class="frame-box photo-box">
                        <i class="bi bi-person" style="font-size:1.2rem"></i>
                        صورة
                    </div>
                </div>
                <div style="text-align: center; width: 150px;">
                    <div style="font-size: 12px; font-weight: bold; margin-bottom: 30px;">توقيع الموكل</div>
                    <div style="border-top: 1px solid #000; font-size: 12px;">@(firstParty?.PartyName)</div>
                </div>
            </div>

            <div class="certification-box">
                <div class="cert-title">مصادقة المحامي:</div>
                <div class="cert-text">
                    أنا المحامي <span class="bold">@Model.LawyerName</span> (رقم الإجازة: @Model.LawyerMembershipId)،
                    أشهد بأن الموكل قد حضر أمامي شخصياً، وبعد التحقق من هويته وأهليته، وقع على هذه الوكالة أمامي وأقر بما جاء فيها.
                </div>

                <div class="signatures-grid">
                    <div class="sig-item">
                        <div class="sig-label">المحامي</div>
                        <div class="sig-line"></div>
                    </div>
                    <div class="sig-item">
                        <div class="sig-label">المصادقة</div>
                        <div class="sig-line"></div>
                    </div>
                    <div class="sig-item">
                        <div class="sig-label">شاهد 1</div>
                        <div class="sig-line"></div>
                    </div>
                    <div class="sig-item">
                        <div class="sig-label">شاهد 2</div>
                        <div class="sig-line"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            نقابة المحامين الفلسطينيين - نظام الإدارة الإلكتروني
        </div>
    </div>

</body>
</html>