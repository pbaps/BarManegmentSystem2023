@model BarManegment.Models.FeeType

@{
    ViewBag.Title = "تعديل نوع الرسم";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<div class="card shadow-sm">
    <div class="card-header bg-warning bg-opacity-25 text-dark">
        <h5 class="mb-0"><i class="bi bi-pencil-square me-2"></i> تعديل: @Model.Name</h5>
    </div>
    <div class="card-body">
        @using (Html.BeginForm())
        {
            @Html.AntiForgeryToken()
            @Html.HiddenFor(model => model.Id)

        <div class="form-horizontal">
            @Html.ValidationSummary(true, "", new { @class = "text-danger" })

            <div class="row mb-3">
                <div class="col-md-6">
                    @Html.LabelFor(model => model.Name, "اسم الرسم", htmlAttributes: new { @class = "form-label fw-bold" })
                    @Html.EditorFor(model => model.Name, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Name, "", new { @class = "text-danger" })
                </div>
                <div class="col-md-6">
                    @Html.LabelFor(model => model.DefaultAmount, "المبلغ الافتراضي", htmlAttributes: new { @class = "form-label fw-bold" })
                    @Html.EditorFor(model => model.DefaultAmount, new { htmlAttributes = new { @class = "form-control", type = "number", step = "0.01" } })
                    @Html.ValidationMessageFor(model => model.DefaultAmount, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    @Html.LabelFor(model => model.CurrencyId, "العملة", htmlAttributes: new { @class = "form-label fw-bold" })
                    @Html.DropDownList("CurrencyId", null, htmlAttributes: new { @class = "form-select" })
                    @Html.ValidationMessageFor(model => model.CurrencyId, "", new { @class = "text-danger" })
                </div>
                <div class="col-md-6">
                    @Html.LabelFor(model => model.BankAccountId, "الحساب البنكي (للإيداع)", htmlAttributes: new { @class = "form-label fw-bold" })
                    @Html.DropDownList("BankAccountId", null, htmlAttributes: new { @class = "form-select" })
                    @Html.ValidationMessageFor(model => model.BankAccountId, "", new { @class = "text-danger" })
                </div>
            </div>

            <!-- ✅ الإضافة الجديدة: ربط الحساب المحاسبي -->
            <div class="row mb-3">
                <div class="col-md-12">
                    <label class="form-label fw-bold text-success">
                        <i class="bi bi-journal-bookmark-fill me-1"></i> الحساب المحاسبي (للإيرادات)
                    </label>
                    @Html.DropDownList("RevenueAccountId", null, "--- الحساب الافتراضي (عام) ---", htmlAttributes: new { @class = "form-select select2" })
                    <div class="form-text text-muted">حدد الحساب الذي سيتم ترحيل الإيراد إليه في كشف الحساب (مثل: 4101 - رسوم انتساب).</div>
                    @Html.ValidationMessageFor(model => model.RevenueAccountId, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="row mb-3 bg-light p-3 border rounded">
                <div class="col-12 mb-2">
                    <h6 class="text-primary fw-bold"><i class="bi bi-pie-chart-fill me-2"></i> توزيع الإيراد (للخدمات المشتركة فقط)</h6>
                    <small class="text-muted">استخدم هذا القسم فقط للرسوم التي يتم تقاسمها (مثل الطوابع والعقود). للرسوم العادية اترك نسبة النقابة 1.00.</small>
                </div>
                <div class="col-md-6">
                    @Html.LabelFor(model => model.LawyerPercentage, "نسبة المحامي (0.00 - 1.00)", htmlAttributes: new { @class = "form-label fw-bold" })
                    @Html.EditorFor(model => model.LawyerPercentage, new { htmlAttributes = new { @class = "form-control", type = "number", step = "0.01", min = "0", max = "1" } })
                    <div class="form-text text-muted">مثال: 0.40 تعني 40% للمحامي.</div>
                    @Html.ValidationMessageFor(model => model.LawyerPercentage, "", new { @class = "text-danger" })
                </div>
                <div class="col-md-6">
                    @Html.LabelFor(model => model.BarSharePercentage, "نسبة النقابة (0.00 - 1.00)", htmlAttributes: new { @class = "form-label fw-bold" })
                    @Html.EditorFor(model => model.BarSharePercentage, new { htmlAttributes = new { @class = "form-control", type = "number", step = "0.01", min = "0", max = "1" } })
                    <div class="form-text text-muted">مثال: 0.60 تعني 60% للنقابة.</div>
                    @Html.ValidationMessageFor(model => model.BarSharePercentage, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <div class="form-check form-switch mt-4">
                        @Html.EditorFor(model => model.IsActive)
                        <label class="form-check-label fw-bold me-2" for="IsActive">فعال</label>
                    </div>
                </div>
            </div>

            <hr />
            <div class="row">
                <div class="col-12 text-end">
                    <a href="@Url.Action("Index")" class="btn btn-secondary me-2">إلغاء</a>
                    <button type="submit" class="btn btn-primary px-4">حفظ التعديلات</button>
                </div>
            </div>
        </div>
        }
    </div>
</div>