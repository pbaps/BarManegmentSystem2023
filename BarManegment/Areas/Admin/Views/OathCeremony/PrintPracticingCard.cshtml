@model BarManegment.Areas.Admin.ViewModels.TraineeIdCardViewModel
@{
    Layout = null;
    string photoUrl = !string.IsNullOrEmpty(Model.PersonalPhotoPath)
                      ? Url.Content(Model.PersonalPhotoPath)
                      : "/Content/Images/default-avatar.png";

    // سنة البطاقة (تؤخذ عادة من تاريخ الانتهاء)
    int cardYear = Model.CardExpiryDate.Year;
}

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <title>بطاقة مزاولة @cardYear - @Model.TraineeName</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* إعدادات الصفحة لطابعات البطاقات (CR-80 Size) */
        @@page {
            size: 85.6mm 54mm; /* الحجم القياسي للبطاقة البلاستيكية */
            margin: 0; /* إلغاء الهوامش للطابعة */
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #ccc; /* لون خلفية للعرض فقط */
            font-family: 'Cairo', sans-serif;
            /* توسيط للعرض على الشاشة */
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding-top: 20px;
        }

        /* تنسيق البطاقة */
        .id-card {
            width: 85.6mm;
            height: 54mm;
            background-color: white;
            position: relative;
            overflow: hidden;
            box-sizing: border-box;
            /* في العرض العادي نظهر حدود، في الطباعة تختفي */
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        /* --- الوجه الأمامي --- */
        .header-bg {
            background-color: #003366;
            height: 16mm;
            width: 120%;
            position: absolute;
            top: -2mm;
            right: -10%;
            border-bottom-left-radius: 50% 4mm;
            border-bottom-right-radius: 50% 4mm;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding-top: 2mm;
        }

        .header-text {
            text-align: center;
            color: white;
            z-index: 2;
            margin-right: 12mm; /* إزاحة للنص */
        }

        .header-text h1 { font-size: 8pt; font-weight: 800; margin: 0; line-height: 1.1; }
        .header-text h2 { font-size: 4.5pt; font-weight: normal; margin: 0; letter-spacing: 1px; text-transform: uppercase; opacity: 0.9; }

        .logo {
            position: absolute;
            top: 2mm;
            right: 3mm;
            width: 11mm;
            height: 11mm;
            background: white;
            border-radius: 50%;
            padding: 0.5mm;
            z-index: 3;
        }

        /* سنة البطاقة */
        .card-year {
            position: absolute;
            top: 3mm;
            left: 3mm;
            color: #b8860b; /* ذهبي */
            font-size: 10pt;
            font-weight: 800;
            z-index: 4;
            background: white;
            padding: 0 4px;
            border-radius: 3px;
            line-height: 1;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .card-body {
            margin-top: 16mm;
            padding: 1mm 3mm;
            display: flex;
            justify-content: space-between;
            height: calc(100% - 16mm);
        }

        .info-col {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            padding-left: 1mm;
            padding-top: 2mm;
        }

        .lawyer-name {
            font-size: 9pt;
            font-weight: 800;
            color: #003366;
            margin-bottom: 2px;
            border-bottom: 1px solid #b8860b;
            display: inline-block;
            width: 95%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .info-row {
            display: flex;
            font-size: 6.5pt;
            margin-bottom: 0.5mm;
            align-items: center;
        }

        .label { color: #555; font-weight: 700; width: 18mm; flex-shrink: 0; }
        .value { color: #000; font-weight: 700; font-family: sans-serif; }

        .status-badge {
            background-color: #006400;
            color: white;
            padding: 0px 3px;
            border-radius: 2px;
            font-size: 5.5pt;
        }

        /* الصورة الشخصية */
        .photo-box {
            width: 19mm;
            height: 24mm;
            border: 1px solid #ccc;
            border-radius: 2mm;
            overflow: hidden;
            background: #eee;
            margin-top: 1mm;
            z-index: 5;
        }
        .photo-box img { width: 100%; height: 100%; object-fit: cover; }

        /* شريط سفلي */
        .bottom-strip {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3.5mm;
            background-color: #b8860b;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 5.5pt;
            font-weight: bold;
        }

        /* --- الوجه الخلفي --- */
        .back-face { display: flex; flex-direction: row; }
        .side-strip { width: 5mm; height: 100%; background-color: #003366; display: flex; align-items: center; justify-content: center; }
        .side-text { writing-mode: vertical-rl; transform: rotate(180deg); color: white; font-size: 6pt; letter-spacing: 2px; font-weight: bold; }

        .back-content {
            flex: 1;
            padding: 3mm;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .legal-text {
            font-size: 6pt;
            font-weight: 700;
            color: #003366;
            line-height: 1.3;
            border: 1px solid #eee;
            padding: 1.5mm;
            border-radius: 2mm;
            background: #f9f9f9;
            margin-bottom: 2mm;
        }

        .notes { font-size: 5pt; color: #777; margin-bottom: 2mm; }

        .qr-container { margin-top: auto; margin-bottom: 2mm; }

        /* أزرار التحكم */
        .no-print {
            position: fixed;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            z-index: 999;
        }
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            font-family: 'Cairo';
            font-weight: bold;
            cursor: pointer;
            color: white;
            font-size: 12px;
        }
        .btn-print { background: #003366; }
        .btn-close { background: #666; text-decoration: none; text-align: center; }

        @@media print {
            body {
                background: none;
                padding: 0;
                display: block;
                margin: 0;
            }
            .no-print { display: none; }

            /* كل بطاقة في صفحة مستقلة للطابعة */
            .id-card {
                margin: 0;
                box-shadow: none;
                border: none;
                page-break-after: always; /* أمر الطابعة بقطع الصفحة بعد كل وجه */
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            /* إخفاء الفواصل */
            .cards-container { display: block; }
        }
    </style>
</head>
<body>

    <div class="no-print">
        <button onclick="window.print()" class="btn btn-print">طباعة البطاقة (الوجهين)</button>
        <a href="javascript:window.close()" class="btn btn-close">إغلاق</a>
    </div>

    <!-- الوجه الأمامي -->
    <div class="id-card front-face">
        <div class="header-bg">
            <div class="header-text">
                <h1>نقابة المحامين الفلسطينيين</h1>
                <h2>PALESTINIAN BAR ASSOCIATION</h2>
            </div>
        </div>
        <img src="~/Content/Images/pba-logo.png" class="logo" alt="Logo" />
        <div class="card-year">@cardYear</div> <!-- سنة البطاقة -->

        <div class="card-body">
            <div class="info-col">
                <div class="lawyer-name">@Model.TraineeName</div>

                <div class="info-row">
                    <span class="label">رقم العضوية:</span>
                    <span class="value" dir="ltr">@Model.MembershipId</span>
                </div>

                <div class="info-row">
                    <span class="label">رقم الهوية:</span>
                    <span class="value">@Model.NationalIdNumber</span>
                </div>

                <div class="info-row">
                    <span class="label">الصفة:</span>
                    <span class="status-badge">@Model.ProfessionalStatus</span>
                </div>

                <!-- إضافة تاريخ المزاولة -->
                <div class="info-row">
                    <span class="label">تاريخ المزاولة:</span>
                    <span class="value">@(Model.PracticeStartDate?.ToString("yyyy/MM/dd") ?? "-")</span>
                </div>

                <div class="info-row">
                    <span class="label" style="color: #b91d1d;">ينتهي في:</span>
                    <span class="value" style="color: #b91d1d;">@Model.CardExpiryDate.ToString("yyyy/MM/dd")</span>
                </div>
            </div>

            <div class="photo-box">
                <img src="@photoUrl" alt="Photo" />
            </div>
        </div>

        <div class="bottom-strip">
            محافظة @(Model.Governorate ?? "القدس")
        </div>
    </div>

    <!-- الوجه الخلفي -->
    <div class="id-card back-face">
        <div class="side-strip">
            <div class="side-text">PBA GAZA</div>
        </div>
        <div class="back-content">
            <div class="qr-container">
                <canvas id="qr-code"></canvas>
            </div>

            <div class="legal-text">
                الرجاء من كافة الجهات الرسمية والمدنية والأمنية تسهيل مهمة حامل هذه البطاقة وتقديم العون له وفقاً للقانون.
            </div>

            <div class="notes">
                * البطاقة ملك للنقابة ويجب إعادتها عند الطلب.
                <br>
                * في حال العثور عليها يرجى تسليمها لأقرب مركز شرطة.
            </div>

            <div style="font-size: 5.5pt; font-weight: bold; margin-top: 3mm; width: 100%; text-align: center;">
                توقيع النقيب: _________________
            </div>
        </div>
    </div>

    <!-- مكتبة QR Code -->
    <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
    <script>
        (function() {
            var qr = new QRious({
                element: document.getElementById('qr-code'),
                value: '@Model.QRCodeData',
                size: 80 // حجم مناسب للبطاقة
            });
        })();
    </script>

</body>
</html>