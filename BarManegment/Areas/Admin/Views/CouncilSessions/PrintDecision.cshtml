@model BarManegment.Models.AgendaItem

@{
    Layout = null;
    // تصفية الحضور: نحتاج فقط الذين كانوا "حاضرين" للتوقيع
    var presentMembers = Model.CouncilSession.Attendees.Where(a => a.IsPresent).ToList();
}

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <title>قرار إداري - @Model.Title</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
 

        body {
            font-family: 'Amiri', serif;
            padding: 30px;
            background: #fff;
            line-height: 1.8;
        }
        .decision-container {
            border: 2px solid #000;
            padding: 30px;
            min-height: 90vh;
            position: relative;
        }
        .header-logo { text-align: center; margin-bottom: 30px; border-bottom: 1px solid #000; padding-bottom: 20px; }
        .decision-title {
            text-align: center;
            font-family: 'Cairo', sans-serif;
            font-weight: bold;
            font-size: 22px;
            margin: 30px 0;
            text-decoration: underline;
        }
        .content-block { font-size: 18px; margin-bottom: 20px; text-align: justify; }
        .decision-text {
            background-color: #f9f9f9;
            border: 1px solid #ccc;
            padding: 20px;
            font-weight: bold;
            margin: 20px 0;
        }

        .signatures-grid {
            margin-top: 60px;
            width: 100%;
        }
        .sig-cell {
            border: 1px solid #ccc;
            padding: 10px;
            height: 100px;
            vertical-align: top;
        }
        .sig-name { font-weight: bold; font-family: 'Cairo', sans-serif; font-size: 14px; }

        @("@")media print {
            .no-print { display: none !important; }
            .decision-container { border: none; }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="no-print mb-3">
            <button onclick="window.print()" class="btn btn-dark">🖨️ طباعة القرار</button>
            <button onclick="window.close()" class="btn btn-secondary">إغلاق</button>
        </div>

        <div class="decision-container">
            <div class="header-logo">
                <div class="row">
                    <div class="col-4 text-end">
                        <h6>نقابة المحامين النظاميين</h6>
                        <h6>مجلس النقابة</h6>
                    </div>
                    <div class="col-4 text-center">
                        <img src="https://placehold.co/80x80?text=LOGO" alt="Logo" style="opacity:0.5" />
                    </div>
                    <div class="col-4 text-start">
                        <h6>التاريخ: @DateTime.Now.ToShortDateString()</h6>
                        <h6>رقم الجلسة: @Model.CouncilSession.SessionNumber / @Model.CouncilSession.Year</h6>
                    </div>
                </div>
            </div>

            <div class="decision-title">قرار مجلس النقابة رقم (@Model.Id)</div>

            <div class="content-block">
                لاحقاً للجلسة رقم (<strong>@Model.CouncilSession.SessionNumber</strong>) المنعقدة بتاريخ <strong>@Model.CouncilSession.SessionDate.ToShortDateString()</strong>، وبعد الاطلاع على الطلب المقدم بخصوص:
                <br />
                <strong>"@Model.Title"</strong>
            </div>
            @if (Model.Attachments != null && Model.Attachments.Any())
            {
                <div class="content-block">
                    <strong>المستندات المرفقة:</strong>
                    <ul>
                        @foreach (var doc in Model.Attachments)
                        {
                            <li>@doc.FileName</li>
                        }
                    </ul>
                </div>
            }
            <div class="content-block">
                والذي يتضمن: @Model.Description
            </div>

            <div class="content-block">
                <strong>فقد قرر مجلس النقابة ما يلي:</strong>
            </div>

            <div class="decision-text text-center">
                @if (Model.CouncilDecisionType == "Approved")
                {
                    <span class="text-success">[ تمت الموافقة ]</span><br />
                }
                else if (Model.CouncilDecisionType == "Rejected")
                {
                    <span class="text-danger">[ تم الرفض ]</span><br />
                }

                @Model.DecisionText
            </div>

            <div class="signatures-grid">
                <h5 class="mb-3" style="font-family: 'Cairo'">توقيع أعضاء المجلس الحضور:</h5>

                <div class="row">
                    @foreach (var member in presentMembers)
                    {
                        <div class="col-4 mb-3">
                            <div class="sig-cell">
                                <div class="sig-name">@member.MemberName</div>
                                <div class="text-muted small">(@(member.Notes ?? "عضو مجلس"))</div>
                            </div>
                        </div>
                    }
                </div>
            </div>

            <div class="mt-5 pt-3 text-center border-top">
                <strong>ختم النقابة</strong>
            </div>
        </div>
    </div>

</body>
</html>