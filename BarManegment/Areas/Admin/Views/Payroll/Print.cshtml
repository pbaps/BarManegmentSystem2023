@model BarManegment.Models.MonthlyPayroll

@{
    Layout = null; // بدون Layout
}

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مسير رواتب @Model.Month-@Model.Year</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #525659;
            margin: 0;
            padding: 0;
        }

        /* تنسيق ورقة A4 بالعرض (Landscape) */
        .page {
            width: 297mm; /* عرض A4 Landscape */
            min-height: 210mm;
            padding: 15mm;
            margin: 10mm auto;
            background: white;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        /* تنسيقات الطباعة */
        @@media print {
            @@page {
                size: A4 landscape; /* إجبار الطابعة على الوضع الأفقي */
                margin: 10mm;
            }

            body {
                background: white;
            }

            .page {
                margin: 0;
                border: initial;
                width: 100%;
                min-height: initial;
                box-shadow: initial;
                page-break-after: always;
            }

            .no-print {
                display: none !important;
            }
            /* طباعة الخلفيات الملونة */
            .bg-light {
                background-color: #f8f9fa !important;
                -webkit-print-color-adjust: exact;
            }

            .bg-dark {
                background-color: #212529 !important;
                color: white !important;
                -webkit-print-color-adjust: exact;
            }
        }

        .header-line {
            border-bottom: 2px solid #000;
            margin-bottom: 15px;
            padding-bottom: 10px;
        }

        .payroll-table th, .payroll-table td {
            font-size: 0.8rem; /* تصغير الخط قليلاً ليناسب الجدول */
            vertical-align: middle;
            padding: 6px 4px;
            border-color: #999;
        }

        .payroll-table th {
            background-color: #e9ecef !important;
            font-weight: bold;
            text-align: center;
        }

        .signature-section {
            margin-top: 40px;
            page-break-inside: avoid;
        }

        .signature-box {
            text-align: center;
            margin-top: 50px;
            border-top: 1px dashed #000;
            padding-top: 10px;
            width: 80%;
            margin-left: auto;
            margin-right: auto;
        }
    </style>
</head>
<body>

    <div class="text-center no-print py-3">
        <button onclick="window.print()" class="btn btn-primary fw-bold px-4">🖨 طباعة الكشف</button>
        <button onclick="window.close()" class="btn btn-secondary px-4">إغلاق</button>
    </div>

    <div class="page">

        <div class="row align-items-center header-line text-center">
            <div class="col-3">
                <h6 class="fw-bold mb-1">نقابة المحامين الفلسطينيين</h6>
                <small>الدائرة المالية</small>
            </div>
            <div class="col-6">
                <h4 class="fw-bold mb-1">كشف رواتب الموظفين</h4>
                <h6 class="fw-bold">عن شهر: @Model.Month / سنة: @Model.Year</h6>
            </div>
            <div class="col-3 text-start">
                <small>تاريخ الإصدار: @Model.IssueDate.ToString("yyyy/MM/dd")</small><br />
                <small>رقم المسير: @Model.Id</small>
            </div>
        </div>

        <table class="table table-bordered payroll-table text-center w-100">
            <thead>
                <tr>
                    <th rowspan="2" width="3%">#</th>
                    <th rowspan="2" width="15%">اسم الموظف / المسمى</th>
                    <th colspan="4">الاستحقاقات (Earnings)</th>
                    <th rowspan="2" class="bg-light">إجمالي<br>الراتب</th>
                    <th colspan="2">الاستقطاعات (Deductions)</th>
                    <th rowspan="2" class="bg-dark text-white">صافي الراتب<br>(Net Pay)</th>
                    <th rowspan="2" width="10%">التوقيع / ملاحظات</th>
                </tr>
                <tr>
                    <th>الأساسي</th>
                    <th>علاوات</th>
                    <th>ز.سنوية</th>
                    <th>مواصلات</th>
                    <th>تأمين (7%)</th>
                    <th>أخرى</th>
                </tr>
            </thead>
            <tbody>
                @{ int counter = 1; }
                @foreach (var item in Model.PayrollSlips)
                {
                    <tr>
                        <td>@counter</td>
                        <td class="text-start">
                            <strong>@item.Employee.FullName</strong><br />
                            <span class="text-muted" style="font-size: 0.7rem;">@(item.Employee.JobTitle?.Name ?? "-")</span>
                        </td>
                        <td>@item.BasicSalary.ToString("N0")</td>
                        <td>@item.AllowancesTotal.ToString("N0")</td>
                        <td>@item.AnnualIncrementAmount.ToString("N0")</td>
                        <td>@item.TransportAllowance.ToString("N0")</td>

                        <td class="fw-bold bg-light">@item.GrossSalary.ToString("N2")</td>

                        <td class="text-danger">@item.EmployeePensionDeduction.ToString("N2")</td>
                        <td class="text-danger">@item.OtherDeductions.ToString("N2")</td>

                        <td class="fw-bold bg-dark text-white">@item.NetSalary.ToString("N2")</td>
                        <td></td>
                    </tr>
                    counter++;
                }
            </tbody>
            <tfoot style="border-top: 2px solid #000;">
                <tr class="fw-bold bg-light">
                    <td colspan="2" class="text-end pe-3">الإجمالي الكلي:</td>
                    <td>@Model.PayrollSlips.Sum(x => x.BasicSalary).ToString("N0")</td>
                    <td>@Model.PayrollSlips.Sum(x => x.AllowancesTotal).ToString("N0")</td>
                    <td>@Model.PayrollSlips.Sum(x => x.AnnualIncrementAmount).ToString("N0")</td>
                    <td>@Model.PayrollSlips.Sum(x => x.TransportAllowance).ToString("N0")</td>
                    <td>@Model.TotalGrossAmount.ToString("N2")</td>
                    <td class="text-danger">@Model.PayrollSlips.Sum(x => x.EmployeePensionDeduction).ToString("N2")</td>
                    <td class="text-danger">@Model.PayrollSlips.Sum(x => x.OtherDeductions).ToString("N2")</td>
                    <td class="bg-dark text-white fs-6">@Model.TotalNetAmount.ToString("N2")</td>
                    <td></td>
                </tr>
            </tfoot>
        </table>

        <div class="row signature-section">
            <div class="col-3">
                <div class="signature-box">إعداد / شؤون الموظفين</div>
            </div>
            <div class="col-3">
                <div class="signature-box">مراجعة / المحاسب</div>
            </div>
            <div class="col-3">
                <div class="signature-box">تدقيق / المدير المالي</div>
            </div>
            <div class="col-3">
                <div class="signature-box">اعتماد / أمين الصندوق</div>
            </div>
        </div>

    </div>

</body>
</html>
