@model BarManegment.Models.GraduateApplication
@{
    Layout = "~/Areas/Admin/Views/Shared/_PrintDocumentsLayout.cshtml";
}

<style>
    /* ... (نفس الستايل القديم) ... */
    .page {
        font-family: 'Amiri', 'Traditional Arabic', serif;
        background-image: url('/Content/Images/logo-watermark.png');
        background-repeat: no-repeat;
        background-position: center;
        background-size: 65%;
        padding: 20mm 25mm;
        color: #000;
        direction: rtl;
    }
    /* ... باقي الستايل ... */
    .signature-settings {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        margin: 20px auto;
        width: 210mm;
        direction: rtl;
    }
</style>

<div class="no-print signature-settings shadow-sm">
    <h6 class="fw-bold text-primary mb-3"><i class="bi bi-pen-fill"></i> إعدادات التوقيع</h6>
    <div class="row g-3">
        <div class="col-md-4">
            <label class="small text-muted">اختر الموقع:</label>
            <select id="signerSelect" class="form-select form-select-sm" onchange="updateSigner()">
                <option value="none">-- بدون توقيع --</option>

                @if (ViewBag.SignersList != null)
                {
                    foreach (var item in (SelectList)ViewBag.SignersList)
                    {
                        // تحديد أمين السر افتراضياً لإفادات التدريب
                        bool isSelected = item.Text.Contains("أمين السر");
                        <option value="@item.Value" @(isSelected ? "selected" : "")>@item.Text</option>
                    }
                }

                <option value="custom">--- إدخال يدوي ---</option>
            </select>
        </div>
        <div class="col-md-4">
            <label class="small text-muted">الاسم:</label>
            <input type="text" id="signerNameInput" class="form-control form-control-sm" oninput="syncSignerDisplay()">
        </div>
        <div class="col-md-4">
            <label class="small text-muted">الصفة:</label>
            <input type="text" id="signerTitleInput" class="form-control form-control-sm" oninput="syncSignerDisplay()">
        </div>
    </div>
</div>

<div class="page">
    <div class="header">
        <div class="header-right">
            <div class="org-name-ar">نقابة المحامين النظاميين الفلسطينيين</div>
            <div class="sub-text">القدس - المركز الرئيسي</div>
        </div>
        <div class="logo-box">
            <img src="~/Content/Images/logo.png" class="logo-img" alt="Logo" onerror="this.style.display='none'" />
        </div>
        <div class="header-left">
            <div class="org-name-en">PALESTINIAN BAR ASSOCIATION</div>
        </div>
    </div>

    <div class="doc-title">
        <h1>إفـــــــــــــــــادة</h1>
    </div>

    <div class="content-body">
        <div class="intro-line">تفيد نقابة المحامين الفلسطينيين</div>

        <div class="data-line">
            <span class="data-label">بأن الأستاذ/ة</span>
            <span class="data-field">@Model.ArabicName</span>
        </div>

        <div class="data-line" style="justify-content: right;">
            <span class="data-label">هوية رقم /</span>
            <span class="data-field" style="max-width: 200px; flex-grow: 0; width: 200px;">@Model.NationalIdNumber</span>
        </div>

        <div class="data-line">
            <span class="data-label">هو محامي متدرب لدى مكتب الأستاذ/ة</span>
            <span class="data-field">@(Model.Supervisor?.ArabicName ?? "غير محدد")</span>
        </div>

        <div class="data-line">
            <span class="data-label">ومسجل في سجل المحامين المتدربين منذ تاريخ /</span>
            <span class="data-field" style="max-width: 150px;">@(Model.TrainingStartDate.HasValue ? Model.TrainingStartDate.Value.ToString("yyyy/MM/dd") : "---")</span>
            <span class="data-label" style="margin-right: auto;">وحتى تاريخه</span>
        </div>

        <div style="text-align: center; margin-top: 50px; font-size: 16pt;">
            وقد أعطيت له هذه الإفادة بناءً على طلبه من واقع ملفه بالنقابة
        </div>
    </div>

    <div class="footer-section">
        <div class="date-section">
            حرر في : @DateTime.Now.ToString("yyyy/MM/dd")
        </div>

        <div class="signature-section" id="signatureSection">
            <div>نقابة المحامين الفلسطينيين - مركز غزة</div>
            <div id="displayTitle" style="margin-top: 10px;"></div>
            <div id="displayName" style="margin-top: 30px;"></div>
        </div>
    </div>

    <div class="bottom-bar">
        القدس عاصمة فلسطين الأبدية
    </div>
</div>

<script>
    function updateSigner() {
        var selected = document.getElementById("signerSelect").value;
        var section = document.getElementById("signatureSection");

        if (selected === "none") {
            section.style.visibility = "hidden";
            document.getElementById("signerNameInput").value = "";
            document.getElementById("signerTitleInput").value = "";
        } else {
            section.style.visibility = "visible";
            if (selected === "custom") {
                document.getElementById("signerNameInput").value = "";
                document.getElementById("signerTitleInput").value = "";
            } else {
                var parts = selected.split('|');
                var name = parts[0];
                var title = parts[1];

                if (!name.includes("الأستاذ") && !name.includes("المستشار")) {
                    name = "الأستاذ " + name;
                }

                document.getElementById("signerNameInput").value = name;
                document.getElementById("signerTitleInput").value = title;
            }
        }
        syncSignerDisplay();
    }

    function syncSignerDisplay() {
        document.getElementById("displayName").innerText = document.getElementById("signerNameInput").value;
        document.getElementById("displayTitle").innerText = document.getElementById("signerTitleInput").value;
    }

    window.onload = function () { updateSigner(); };
</script>