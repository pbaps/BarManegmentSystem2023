@model BarManegment.Models.GraduateApplication
@{
    Layout = "~/Areas/Admin/Views/Shared/_PrintDocumentsLayout.cshtml";
}

<style>
    .page {
        font-family: 'Cairo', sans-serif;
        font-size: 12pt;
    }

    .box {
        border: 2px solid #444;
        border-radius: 5px;
        padding: 10px;
        margin-bottom: 15px;
    }

    .row-info {
        display: flex;
        margin-bottom: 8px;
        border-bottom: 1px dotted #eee;
        padding-bottom: 2px;
    }

    .label {
        width: 140px;
        font-weight: bold;
        color: #aa0000;
    }

    .value {
        flex-grow: 1;
        font-weight: 500;
    }

    h2 {
        text-align: center;
        color: #cc0000;
        border-bottom: 2px solid #cc0000;
        padding-bottom: 10px;
        margin-bottom: 30px;
    }

    .trainees-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }

        .trainees-table th, .trainees-table td {
            border: 1px solid #444;
            padding: 5px;
            text-align: center;
        }

        .trainees-table th {
            background-color: #eee;
        }

    /* لوحة إعدادات التوقيع (نفس التنسيق الموحد) */
    .signature-settings {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        margin: 20px auto;
        width: 210mm;
        direction: rtl;
    }

    .footer-signatures {
        margin-top: 50px;
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        padding-left: 20px;
    }

    .signature-block {
        text-align: center;
        font-weight: bold;
        min-width: 200px;
    }
</style>

<!-- لوحة تحكم التوقيع (لا تظهر في الطباعة) -->
<div class="no-print signature-settings shadow-sm">
    <h6 class="fw-bold text-primary mb-3"><i class="bi bi-pen-fill"></i> إعدادات التوقيع (اختياري)</h6>
    <div class="row g-3">
        <div class="col-md-4">
            <label class="small text-muted">اختر الموقع:</label>
            <select id="signerSelect" class="form-select form-select-sm" onchange="updateSigner()">
                <option value="none" selected>-- بدون توقيع رسمي --</option>
                <option value="System Admin|مدير النظام">مدير النظام</option>
                <option value="علي الدن|أمين الصندوق">أمين الصندوق (علي الدن)</option>
                <option value="زياد عطا النجار|أمين السر">أمين السر (زياد النجار)</option>
                <option value="custom">--- إدخال يدوي ---</option>
            </select>
        </div>
        <div class="col-md-4">
            <label class="small text-muted">الاسم:</label>
            <input type="text" id="signerNameInput" class="form-control form-control-sm" oninput="syncSignerDisplay()">
        </div>
        <div class="col-md-4">
            <label class="small text-muted">الصفة:</label>
            <input type="text" id="signerTitleInput" class="form-control form-control-sm" oninput="syncSignerDisplay()">
        </div>
    </div>
</div>

<div class="page">
    <div style="text-align: center; margin-bottom: 20px;">
        <img src="~/Content/Images/logo.png" width="80" onerror="this.style.display='none'" />
        <h2>نقابة المحامين الفلسطينيين - بطاقة عضو</h2>
    </div>

    <!-- البيانات الشخصية -->
    <div class="box">
        <div style="float: left; margin-left: 10px; width: 100px; height: 130px; border: 1px solid #ccc; padding: 2px;">
            @if (!string.IsNullOrEmpty(Model.PersonalPhotoPath))
            {
                <img src="@Model.PersonalPhotoPath" style="width: 100%; height: 100%; object-fit: cover;" />
            }
            else
            {
                <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #f9f9f9; color: #aaa;">صورة</div>
            }
        </div>
        <div class="row-info"><span class="label">الاسم رباعي:</span> <span class="value">@Model.ArabicName</span></div>
        <div class="row-info"><span class="label">رقم الهوية:</span> <span class="value">@Model.NationalIdNumber</span></div>
        <div class="row-info"><span class="label">رقم العضوية:</span> <span class="value">@(Model.MembershipId ?? "---")</span></div>
        <div class="row-info"><span class="label">الحالة المهنية:</span> <span class="value">@Model.ApplicationStatus.Name</span></div>
        <div class="row-info"><span class="label">تاريخ المزاولة:</span> <span class="value">@(Model.PracticeStartDate.HasValue ? Model.PracticeStartDate.Value.ToString("yyyy/MM/dd") : "-")</span></div>
        <div class="row-info"><span class="label">الحساب البنكي:</span> <span class="value">@Model.BankName - @Model.AccountNumber</span></div>
    </div>

    <!-- المؤهلات والعنوان -->
    <div class="box">
        <div class="row-info">
            <span class="label">المؤهل العلمي:</span> <span class="value">
                @if (Model.Qualifications.Any())
                {
                    var q = Model.Qualifications.First();
                    @($"{q.QualificationType.Name} - {q.UniversityName} ({q.GraduationYear})")
                }
            </span>
        </div>
        <div class="row-info"><span class="label">العنوان:</span> <span class="value">@(Model.ContactInfo != null ? $"{Model.ContactInfo.Governorate} - {Model.ContactInfo.City}" : "")</span></div>
        <div class="row-info"><span class="label">رقم الجوال:</span> <span class="value">@(Model.ContactInfo != null ? Model.ContactInfo.MobileNumber : "")</span></div>
        <div class="row-info"><span class="label">البريد الإلكتروني:</span> <span class="value">@(Model.ContactInfo != null ? Model.ContactInfo.Email : "")</span></div>
    </div>

    <!-- البيانات المالية -->
    <div class="box">
        <div class="row-info">
            <span class="label">تاريخ آخر دفع:</span>
            <span class="value">@(ViewBag.LastPaymentDate != null ? ((DateTime)ViewBag.LastPaymentDate).ToString("yyyy/MM/dd") : "لا يوجد")</span>
            <span class="label" style="width: auto; margin-right: 20px;">عدد سنوات المزاولة:</span>
            <span class="value" style="margin-right: 10px;">
                @(Model.PracticeStartDate.HasValue ? (DateTime.Now.Year - Model.PracticeStartDate.Value.Year).ToString() : "0")
            </span>
        </div>
    </div>

    <!-- المتدربون (إن وجد) -->
    @if (Model.Trainees != null && Model.Trainees.Any())
    {
        <div class="box">
            <h5 style="margin: 0 0 10px 0; color: #444;">المتدربون المسجلون لدى المحامي:</h5>
            <table class="trainees-table">
                <thead>
                    <tr>
                        <th>اسم المتدرب</th>
                        <th>بداية التدريب</th>
                        <th>الحالة</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var t in Model.Trainees)
                    {
                        <tr>
                            <td>@t.ArabicName</td>
                            <td>@(t.TrainingStartDate.HasValue ? t.TrainingStartDate.Value.ToString("yyyy/MM/dd") : "-")</td>
                            <td>@t.ApplicationStatus.Name</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }

    <!-- منطقة التوقيع الديناميكية -->
    <div class="footer-signatures">
        <div style="font-size: 10pt;">
            تاريخ الطباعة: @DateTime.Now.ToString("yyyy/MM/dd HH:mm")
        </div>

        <!-- التوقيع يظهر هنا فقط إذا تم اختياره -->
        <div class="signature-block" id="signatureSection" style="display: none;">
            <span id="displayTitle"></span><br /><br />
            <span id="displayName"></span>
        </div>
    </div>
</div>

<script>
    function updateSigner() {
        var selected = document.getElementById("signerSelect").value;
        var section = document.getElementById("signatureSection");

        if (selected === "none") {
            section.style.display = "none";
            document.getElementById("signerNameInput").value = "";
            document.getElementById("signerTitleInput").value = "";
        } else if (selected === "custom") {
            section.style.display = "block";
            document.getElementById("signerNameInput").value = "";
            document.getElementById("signerTitleInput").value = "";
        } else {
            section.style.display = "block";
            var parts = selected.split('|');
            document.getElementById("signerNameInput").value = parts[0];
            document.getElementById("signerTitleInput").value = parts[1];
        }
        syncSignerDisplay();
    }

    function syncSignerDisplay() {
        document.getElementById("displayName").innerText = document.getElementById("signerNameInput").value;
        document.getElementById("displayTitle").innerText = document.getElementById("signerTitleInput").value;
    }
</script>