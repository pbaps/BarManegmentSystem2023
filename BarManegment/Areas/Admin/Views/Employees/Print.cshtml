@model BarManegment.Models.Employee
@{
    Layout = null; // بدون Layout لإزالة القوائم
}

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ملف موظف - @Model.FullName</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #525659; /* لون خلفية عارض الـ PDF */
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }

        /* تنسيق ورقة A4 */
        .page {
            width: 210mm;
            min-height: 297mm;
            padding: 20mm;
            margin: 10mm auto;
            border: 1px solid #D3D3D3;
            background: white;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        /* تنسيقات الطباعة الفعلية */
        @@media print {
            body {
                background: white;
                margin: 0;
            }

            .page {
                margin: 0;
                border: initial;
                border-radius: initial;
                width: initial;
                min-height: initial;
                box-shadow: initial;
                background: initial;
                page-break-after: always;
            }

            .no-print {
                display: none !important;
            }
            /* إجبار المتصفح على طباعة الألوان الخلفية */
            .bg-light {
                background-color: #f8f9fa !important;
            }

            .bg-secondary {
                background-color: #e9ecef !important;
            }
        }

        .header-line {
            border-bottom: 2px solid #000;
            margin-bottom: 20px;
            padding-bottom: 10px;
        }

        .data-label {
            font-weight: bold;
            color: #555;
            width: 140px;
            display: inline-block;
        }

        .section-title {
            background-color: #e9ecef;
            padding: 8px 15px;
            font-weight: bold;
            border-right: 5px solid #0d6efd;
            margin-top: 20px;
            margin-bottom: 15px;
            border-radius: 4px;
        }

        .signature-box {
            margin-top: 50px;
            text-align: center;
        }

        .signature-line {
            margin-top: 40px;
            border-top: 1px dashed #000;
            width: 80%;
            margin-left: auto;
            margin-right: auto;
        }

        .profile-img-print {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border: 1px solid #ddd;
            padding: 3px;
        }

        .table-custom th {
            background-color: #f8f9fa;
            font-size: 0.9rem;
        }

        .table-custom td {
            font-size: 0.9rem;
        }
    </style>
</head>
<body>

    <div class="text-center no-print py-3">
        <button onclick="window.print()" class="btn btn-primary fw-bold px-4"><i class="bi bi-printer"></i> طباعة الملف</button>
        <button onclick="window.close()" class="btn btn-secondary px-4">إغلاق</button>
    </div>

    <div class="page">
        <div class="row align-items-center header-line">
            <div class="col-4 text-center">
                <h5 class="fw-bold mb-1">نقابة المحامين الفلسطينيين</h5>
                <small>فلسطين - غزة</small>
            </div>
            <div class="col-4 text-center">
                <img src="https://placehold.co/80x80/transparent/000?text=LOGO" alt="Logo" style="height: 80px;" />
            </div>
            <div class="col-4 text-center">
                <h5 class="fw-bold mb-1">ملف بيانات موظف</h5>
                <small>تاريخ الإصدار: @DateTime.Now.ToString("yyyy/MM/dd")</small>
            </div>
        </div>

        <div class="section-title">أولاً: البيانات الشخصية والوظيفية</div>
        <div class="row">
            <div class="col-9">
                <div class="row mb-2">
                    <div class="col-6"><span class="data-label">الاسم الكامل:</span> @Model.FullName</div>
                    <div class="col-6"><span class="data-label">رقم الهوية:</span> @Model.NationalId</div>
                </div>
                <div class="row mb-2">
                    <div class="col-6"><span class="data-label">المسمى الوظيفي:</span> @(Model.JobTitle?.Name ?? "-")</div>
                    <div class="col-6"><span class="data-label">القسم:</span> @(Model.Department?.Name ?? "-")</div>
                </div>
                <div class="row mb-2">
                    <div class="col-6"><span class="data-label">تاريخ التعيين:</span> @Model.HireDate.ToString("yyyy/MM/dd")</div>
                    <div class="col-6"><span class="data-label">رقم الهاتف:</span> @Model.Phone</div>
                </div>
                <div class="row mb-2">
                    <div class="col-6"><span class="data-label">حالة الموظف:</span> @(Model.IsActive ? "على رأس عمله" : "منتهي خدماته")</div>
                    <div class="col-6">
                        <span class="data-label">سنوات الخدمة:</span>
                        @{
                            var today = DateTime.Now;
                            int serviceYears = today.Year - Model.HireDate.Year;
                            if (Model.HireDate.Date > today.AddYears(-serviceYears)) { serviceYears--; }
                            if (serviceYears < 0) { serviceYears = 0; }
                        }
                        @serviceYears سنوات
                    </div>
                </div>
            </div>
            <div class="col-3 text-center">
                @if (!string.IsNullOrEmpty(Model.ProfilePicturePath))
                {
                    <img src="@Url.Content(Model.ProfilePicturePath)" class="profile-img-print rounded" />
                }
                else
                {
                    <div class="profile-img-print d-flex align-items-center justify-content-center bg-light text-muted">لا توجد صورة</div>
                }
            </div>
        </div>

        <div class="section-title">ثانياً: التفاصيل المالية والراتب</div>
        <table class="table table-bordered table-custom">
            <tbody>
                <tr class="bg-light">
                    <td colspan="4" class="fw-bold text-center">تفاصيل الاستحقاقات (شيكل)</td>
                </tr>
                <tr>
                    <td width="25%" class="fw-bold">الراتب الأساسي</td>
                    <td width="25%">@Model.BasicSalary.ToString("N2")</td>
                    <td width="25%" class="fw-bold">بدل مواصلات</td>
                    <td width="25%">@Model.TransportAllowance.ToString("N2")</td>
                </tr>
                <tr>
                    <td class="fw-bold">الزيادة السنوية (@Model.AnnualIncrementPercent%)</td>
                    <td>@Model.CalculatedAnnualIncrementAmount.ToString("N2")</td>
                    <td class="fw-bold">علاوة تخصص/مهنة</td>
                    <td>@Model.SpecializationAllowance.ToString("N2")</td>
                </tr>
                <tr>
                    <td class="fw-bold">علاوة مدير / قسم</td>
                    <td>@((Model.ManagerAllowance + Model.HeadOfDeptAllowance).ToString("N2"))</td>
                    <td class="fw-bold">علاوة مؤهل علمي</td>
                    <td>@((Model.MasterDegreeAllowance + Model.PhdDegreeAllowance).ToString("N2"))</td>
                </tr>
                <tr class="table-active">
                    <td colspan="2" class="fw-bold text-end fs-6">إجمالي الراتب (Gross):</td>
                    <td colspan="2" class="fw-bold fs-6">@Model.TotalSalary.ToString("N2") شيكل</td>
                </tr>
            </tbody>
        </table>

        <div class="section-title">ثالثاً: التأمين والمعاشات</div>
        <div class="alert alert-secondary p-2 mb-3 small">
            <strong>ملاحظة:</strong> الوعاء التأميني يشمل (الراتب الأساسي + علاوة المؤهل العلمي + علاوة التخصص) فقط.
        </div>
        <table class="table table-bordered table-sm table-custom">
            <thead>
                <tr class="bg-light text-center">
                    <th>الوعاء التأميني</th>
                    <th>حصة الموظف (@Model.EmployeePensionPercent%)</th>
                    <th>مساهمة النقابة (@Model.EmployerPensionPercent%)</th>
                    <th>إجمالي المحول للهيئة</th>
                </tr>
            </thead>
            <tbody>
                <tr class="text-center">
                    <td>@Model.PensionBasisSalary.ToString("N2")</td>
                    <td class="text-danger fw-bold">- @Model.PensionAmountEmployee.ToString("N2")</td>
                    <td class="text-success fw-bold">+ @Model.PensionAmountEmployer.ToString("N2")</td>
                    <td class="fw-bold">@Model.TotalToPensionAuthority.ToString("N2")</td>
                </tr>
            </tbody>
        </table>

        <div class="section-title">رابعاً: الحساب البنكي</div>
        <table class="table table-bordered table-sm mb-0">
            <tr>
                <td width="20%" class="bg-light fw-bold">اسم البنك</td>
                <td width="30%">@Model.BankName</td>
                <td width="20%" class="bg-light fw-bold">الفرع</td>
                <td width="30%">@Model.BankBranch</td>
            </tr>
            <tr>
                <td class="bg-light fw-bold">رقم الحساب</td>
                <td>@Model.BankAccountNumber</td>
                <td class="bg-light fw-bold">IBAN</td>
                <td class="font-monospace small">@Model.IBAN</td>
            </tr>
        </table>

        <div class="row signature-box">
            <div class="col-4">
                <p class="fw-bold">شؤون الموظفين</p>
                <div class="signature-line"></div>
            </div>
            <div class="col-4">
                <p class="fw-bold">المدير المالي</p>
                <div class="signature-line"></div>
            </div>
            <div class="col-4">
                <p class="fw-bold">المدير الإداري</p>
                <div class="signature-line"></div>
            </div>
        </div>

        <div style="position: absolute; bottom: 10mm; width: 100%; text-align: center; border-top: 1px solid #ddd; padding-top: 5px; font-size: 0.8rem; color: #777;">
            تم طباعة هذا المستند بواسطة النظام الآلي - المستخدم: @(Session["FullName"] ?? "Unknown") - التاريخ: @DateTime.Now.ToString("yyyy/MM/dd HH:mm")
        </div>

    </div>

</body>
</html>
