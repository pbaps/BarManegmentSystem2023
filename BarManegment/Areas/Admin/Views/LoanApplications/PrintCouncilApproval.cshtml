@model BarManegment.Models.LoanApplication
@{
    ViewBag.Title = "طباعة قرار مجلس";
    Layout = "~/Areas/Admin/Views/Shared/_PrintLOanayout.cshtml"; // 💡 تصحيح المسار

    // (جلب قائمة أعضاء المجلس من ViewBag)
    var councilMembers = (ViewBag.CouncilMembers as List<BarManegment.Models.CouncilMember>) ?? new List<BarManegment.Models.CouncilMember>();

    // (استخدام "Title" وهو الاسم الصحيح من النموذج CouncilMember.cs)
    var deputy = councilMembers.FirstOrDefault(m => m.Title == "نائب النقيب")?.Name ?? "..................";
    var secretary = councilMembers.FirstOrDefault(m => m.Title == "أمين السر")?.Name ?? "..................";
    var treasurer = councilMembers.FirstOrDefault(m => m.Title == "أمين الصندوق")?.Name ?? "..................";

    // (جلب الأعضاء فقط)
    var members = councilMembers.Where(m => m.Title == "عضو مجلس").ToList();
}

@section styles {
    <style>
        .print-container {
            direction: rtl;
            background: #fff;
            padding: 20mm;
            margin: 20px auto;
            font-family: 'Times New Roman', Times, serif;
            font-size: 16pt;
            line-height: 2.2;
            position: relative;
        }

            .print-container::before {
                content: "PALESTINE";
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) rotate(-45deg);
                font-size: 120pt;
                font-weight: bold;
                color: rgba(220, 220, 220, 0.2);
                z-index: 1;
            }

        .print-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid #dc3545;
            padding-bottom: 10px;
            margin-bottom: 20px;
            position: relative;
            z-index: 2;
        }

            .print-header .logo-container {
                display: flex;
                align-items: center;
            }

            .print-header img {
                max-height: 80px;
                margin-left: 15px;
            }

            .print-header .title-text {
                font-family: 'Cairo', sans-serif;
                font-size: 1.5rem;
                font-weight: bold;
                margin: 0;
                color: #000;
            }

            .print-header .subtitle-text {
                font-size: 1rem;
                font-weight: bold;
                margin: 0;
                color: #333;
            }

            .print-header .loan-id {
                border: 1px solid #000;
                padding: 5px 10px;
                font-weight: bold;
            }

        .print-title {
            text-align: center;
            font-weight: bold;
            font-size: 24pt;
            text-decoration: underline;
            margin: 30px 0;
            position: relative;
            z-index: 2;
        }

        .print-body {
            position: relative;
            z-index: 2;
        }

            .print-body p {
                margin-bottom: 25px;
                text-align: right;
            }

            .print-body strong {
                font-weight: bold;
                color: #000;
            }

        .form-field {
            font-weight: bold;
            font-family: 'Cairo', sans-serif;
            text-decoration: underline;
            padding: 0 5px;
        }

        .signature-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 40px 15px;
            margin-top: 100px;
            text-align: center;
            font-weight: bold;
            position: relative;
            z-index: 2;
            font-size: 12pt;
        }

        .sig-box {
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            min-height: 80px;
        }

            .sig-box .sig-line {
                border-bottom: 1px dotted #000;
                margin-bottom: 5px;
            }

        @@media print {
            body {
                background: #fff;
            }

            .print-container {
                border: none;
                padding: 0;
                margin: 0;
            }

            .print-footer-layout {
                display: none;
            }
        }
    </style>
}

<div class="print-container">

    @* --- رأس الصفحة (كما في الصورة) --- *@
    <div class="print-header">
        <div class="logo-container">
            <img src="@Url.Content("~/Content/Images/logo.png")" alt="شعار نقابة المحامين" />
            <div>
                <h2 class="title-text">نقابة المحامين الفلسطينيين</h2>
                <p class="subtitle-text">PALESTINIAN BAR ASSOCIATION</p>
            </div>
        </div>
        <div class="loan-id">
            رقم القرض/ @Model.Id
        </div>
    </div>

    <div class="print-title">
        قرار مجلس
    </div>

    @* --- جسم النموذج (معبأ بالبيانات) --- *@
    <div class="print-body">
        <p>
            قرر مجلس النقابة منح مقدم الطلب الأستاذ/ <span class="form-field">@Model.Lawyer.ArabicName</span>
        </p>
        <p>
            مبلغ وقدره / <span class="form-field">@Model.Amount.ToString("N2")</span>
            على برنامج القرض الحسن بعد ان يتم مراجعة وتدقيق الطلب
        </p>
        <p>
            واستيفاء اي نقص فيه ويوقع هو الكفلاء وتستكمل الاجراءات الاخرى على ان يسدد القرض على اقساط
            شهرية بواقع / <span class="form-field">@Model.InstallmentAmount.ToString("N2")</span>
            شهريا وعلى ان تبدأ من تاريخ / <span class="form-field">@Model.StartDate.ToString("yyyy/MM/dd")</span>
            وحتى الوفاء التام.
        </p>
    </div>

    @* (تواقيع أعضاء المجلس) *@
    <div class="signature-grid">
        <div class="sig-box">نائب النقيب <div class="sig-line"></div> <small>@deputy</small></div>
        <div class="sig-box">أمين السر <div class="sig-line"></div> <small>@secretary</small></div>
        <div class="sig-box">أمين الصندوق <div class="sig-line"></div> <small>@treasurer</small></div>

        @* (عرض باقي الأعضاء) *@
        @foreach (var member in members.Take(3))
        {
            <div class="sig-box">عضو مجلس <div class="sig-line"></div> <small>@member.Name</small></div>
        }
        @* (إضافة خانات فارغة إذا كان عدد الأعضاء أقل من 3) *@
        @for (int i = 0; i < (3 - members.Count()); i++)
        {
            <div class="sig-box">عضو مجلس <div class="sig-line"></div> <small>..................</small></div>
        }
    </div>

</div>

@section scripts {
    <script>
        window.addEventListener("load", function () {
            window.print();
        });
    </script>
}