@model BarManegment.Models.ContractType

@{
    ViewBag.Title = "إضافة نوع عقد جديد";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0"><i class="bi bi-plus-circle-fill me-2"></i> @ViewBag.Title</h5>
    </div>
    <div class="card-body">
        @using (Html.BeginForm())
        {
            @Html.AntiForgeryToken()

            <div class="form-horizontal">
                @Html.ValidationSummary(true, "", new { @class = "alert alert-danger" })

                @* اسم العقد *@
                <div class="row mb-3">
                    @Html.LabelFor(model => model.Name, htmlAttributes: new { @class = "col-md-2 col-form-label fw-bold" })
                    <div class="col-md-10">
                        @Html.EditorFor(model => model.Name, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.Name, "", new { @class = "text-danger" })
                    </div>
                </div>

                @* العملة *@
                <div class="row mb-3">
                    @Html.LabelFor(model => model.CurrencyId, htmlAttributes: new { @class = "col-md-2 col-form-label fw-bold" })
                    <div class="col-md-10">
                        @Html.DropDownList("CurrencyId", null, "--- اختر العملة ---", htmlAttributes: new { @class = "form-select" })
                        @Html.ValidationMessageFor(model => model.CurrencyId, "", new { @class = "text-danger" })
                    </div>
                </div>

                <hr />

                @* إعدادات الاحتساب *@
                <div class="row mb-3 bg-light p-3 rounded border mx-1">
                    <div class="col-md-12 mb-3">
                        <div class="form-check form-switch">
                            @Html.CheckBoxFor(model => model.IsFixedFee, new { @class = "form-check-input", id = "IsFixedFee", @checked = "checked" })
                            <label class="form-check-label fw-bold" for="IsFixedFee">هل الرسم مبلغ ثابت (مقطوع)؟</label>
                        </div>
                    </div>

                    @* حقل المبلغ الثابت *@
                    <div class="col-md-6" id="fixed-fee-container">
                        @Html.LabelFor(model => model.DefaultFee, "قيمة الرسم الثابت", htmlAttributes: new { @class = "form-label fw-bold" })
                        @Html.EditorFor(model => model.DefaultFee, new { htmlAttributes = new { @class = "form-control", type = "number", step = "0.01" } })
                        @Html.ValidationMessageFor(model => model.DefaultFee, "", new { @class = "text-danger" })
                    </div>

                    @* حقل النسبة *@
                    <div class="col-md-6" id="percentage-container" style="display:none;">
                        @Html.LabelFor(model => model.Percentage, "النسبة من قيمة العقد (مثال: 0.005 للنصف بالمائة)", htmlAttributes: new { @class = "form-label fw-bold" })
                        @Html.EditorFor(model => model.Percentage, new { htmlAttributes = new { @class = "form-control", type = "number", step = "0.0001" } })
                        <small class="text-muted d-block mt-1">مثال: أدخل 0.005 لتمثيل (0.5%).</small>
                        @Html.ValidationMessageFor(model => model.Percentage, "", new { @class = "text-danger" })
                    </div>
                </div>

                <hr />

                @* توزيع الحصص *@
                <div class="row mb-3">
                    <div class="col-md-6">
                        @Html.LabelFor(model => model.LawyerPercentage, htmlAttributes: new { @class = "form-label fw-bold" })
                        @Html.EditorFor(model => model.LawyerPercentage, new { htmlAttributes = new { @class = "form-control", placeholder = "مثال: 0.60" } })
                        @Html.ValidationMessageFor(model => model.LawyerPercentage, "", new { @class = "text-danger" })
                    </div>
                    <div class="col-md-6">
                        @Html.LabelFor(model => model.BarSharePercentage, htmlAttributes: new { @class = "form-label fw-bold" })
                        @Html.EditorFor(model => model.BarSharePercentage, new { htmlAttributes = new { @class = "form-control", placeholder = "مثال: 0.40" } })
                        @Html.ValidationMessageFor(model => model.BarSharePercentage, "", new { @class = "text-danger" })
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-md-10 offset-md-2">
                        <button type="submit" class="btn btn-primary px-4"><i class="bi bi-save"></i> حفظ</button>
                        @Html.ActionLink("العودة إلى القائمة", "Index", null, new { @class = "btn btn-outline-secondary" })
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script>
        $(document).ready(function () {
            function toggleFeeType() {
                if ($('#IsFixedFee').is(':checked')) {
                    $('#fixed-fee-container').show();
                    $('#percentage-container').hide();
                } else {
                    $('#fixed-fee-container').hide();
                    $('#percentage-container').show();
                }
            }

            // عند التحميل وعند التغيير
            toggleFeeType();
            $('#IsFixedFee').change(toggleFeeType);
        });
    </script>
}